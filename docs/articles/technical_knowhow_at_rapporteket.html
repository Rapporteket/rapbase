<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Technical knowhow at Rapporteket • rapbase</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Technical knowhow at Rapporteket">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rapbase</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.8.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dealing_with_dates.html">Registerdata, R og bruk av dato</a>
    </li>
    <li>
      <a href="../articles/r_packages_at_rapporteket.html">Introducing R packages at Rapporteket</a>
    </li>
    <li>
      <a href="../articles/technical_knowhow_at_rapporteket.html">Technical knowhow at Rapporteket</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Rapporteket/rapbase">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Technical knowhow at Rapporteket</h1>
                        <h4 class="author">Are Edvardsen</h4>
            
            <h4 class="date">2019-07-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Rapporteket/rapbase/blob/master/vignettes/technical_knowhow_at_rapporteket.Rmd"><code>vignettes/technical_knowhow_at_rapporteket.Rmd</code></a></small>
      <div class="hidden name"><code>technical_knowhow_at_rapporteket.Rmd</code></div>

    </div>

    
    
<p>Please use as a bin for all kinds of technical informastion relevant for taking a package for a spin at Rapporteket. This doc is liberal in terms of content and one should at whatever comes to mind as relevant. Thus, this vignette might therefore be somewhat lingo agnostic…</p>
<div id="--a--darn-them-buggers" class="section level1">
<h1 class="hasAnchor">
<a href="#--a--darn-them-buggers" class="anchor"></a>Æ, ø, å. Darn them buggers!</h1>
<p>During February 2016 we were poking around in some encoding issues related to establishing a new TEST server at Rapporteket. We were not able to source R files and figures produced were not able to show nordic characters (substituting them with “..”). The first was avoided by using <code><a href="https://www.rdocumentation.org/packages/base/topics/eval">eval(parse("someFile.R", encoding="UTF-8"))</a></code> rather than <code><a href="https://www.rdocumentation.org/packages/base/topics/source">source("someFile.R", encoding="UTF-8")</a></code> but the latter we could not solve. It was likely that these two problems were both related to encoding issues. The solution to this is described below.</p>
<div id="problem" class="section level2">
<h2 class="hasAnchor">
<a href="#problem" class="anchor"></a>Problem</h2>
<p>De ulike versjonene av R/Rserve mlm app-06 og app-08 leser systemets miljøvariabler angående encoding/locale ulikt. app-06 fungerer slik den skal mens app-08 ikke har riktige miljøvariabler satt i sesjonen.</p>
</div>
<div id="reproduksjon-av-feilen" class="section level2">
<h2 class="hasAnchor">
<a href="#reproduksjon-av-feilen" class="anchor"></a>Reproduksjon av feilen</h2>
<p>I en sesjon startet av Rserve, kjør kommandoen</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/locales">Sys.getlocale</a></span>(<span class="dt">category =</span> <span class="st">"LC_ALL"</span>)</code></pre></div>
<p>På app-06 gir dette:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[<span class="dv">1</span>] <span class="st">"LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=nb_NO.UTF-8;LC_COLLATE=en_US.UTF-8;</span>
<span class="st">LC_MONETARY=nb_NO.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=nb_NO.UTF-8;LC_NAME=C;</span>
<span class="st">LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=nb_NO.UTF-8;LC_IDENTIFICATION=C"</span></code></pre></div>
<p>På app-08 gir det samme:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[<span class="dv">1</span>] <span class="st">"C"</span></code></pre></div>
</div>
<div id="lsning" class="section level2">
<h2 class="hasAnchor">
<a href="#lsning" class="anchor"></a>Løsning</h2>
<p>Problemet kan løses ved å endre måten Rserve (daemon) startes. Følgende linje i <em>/etc/init.d/rserve</em></p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">su</span> -p -s /bin/sh <span class="va">$OWNER</span> -c <span class="st">"</span><span class="va">$R_HOME</span><span class="st">/bin/Rserve --vanilla --RS-encoding utf8 </span>
<span class="st">--RS-workdir /opt/jasper/r"</span> <span class="op">&gt;</span> /var/log/jasper/Rserve.log <span class="op">2&gt;&amp;1</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Logic">&amp;</a></span></code></pre></div>
<p>fungerer på app-06. På app-08 må denne endres til:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">su</span> -p -s /bin/sh <span class="va">$OWNER</span> -c <span class="st">"</span><span class="va">$R_HOME</span><span class="st">/bin/Rserve --vanilla --RS-encoding native </span>
<span class="st">--RS-workdir /opt/jasper/r"</span> <span class="op">&gt;</span> /var/log/jasper/Rserve.log <span class="op">2&gt;&amp;1</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Logic">&amp;</a></span></code></pre></div>
<p>der opsjonen <code>--RS-encoding</code> er endret fra <code>utf8</code> til <code>native</code> (endringen er allerede gjort på app-08 ifm feilsøking, men se kommentar under “Mulige konsekvenser av endringen”). Endringen er basert på Rserve sin dokumentasjon:</p>
<blockquote>
<p>String encoding directive was introduced in Rserve 0.5-3. This means that strings are converted to the given encoding before being sent to the client and also all strings from the client are assumed to come from the given encoding. (Previously the strings were always passed as-is with no conversion). The currently supported encodings are “native” (same as the server session locale), “utf8” and “latin1”. The server default is currently “native” for compatibility with previous versions (but may change to “utf8” in the future, so explicit use of encoding in the config file is advised).</p>
</blockquote>
</div>
<div id="mulige-konsekvenser-av-endringen" class="section level2">
<h2 class="hasAnchor">
<a href="#mulige-konsekvenser-av-endringen" class="anchor"></a>Mulige konsekvenser av endringen</h2>
<p>Et mulig utfall av dette er at avvik i konfigurasjon mlm app-06 og app-08, noe som sikkert ikke er heldig mht ivaretakelse av stabil drift. Det kan tenkes at alle miljø (TEST og PROD) bør endret til “native” GITT AT DET GIR RIKTIG UTFALL OGSÅ FOR DISSE SERVERNE. Det er altså ikke testet av meg, men er en endring som Saana og Jan-Inge får gjøre en vurdering av.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#--a--darn-them-buggers">Æ, ø, å. Darn them buggers!</a><ul class="nav nav-pills nav-stacked">
<li><a href="#problem">Problem</a></li>
      <li><a href="#reproduksjon-av-feilen">Reproduksjon av feilen</a></li>
      <li><a href="#lsning">Løsning</a></li>
      <li><a href="#mulige-konsekvenser-av-endringen">Mulige konsekvenser av endringen</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Edvardsen Are, Thon Kevin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
