<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Staging data: principles and set-up â€¢ rapbase</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Staging data: principles and set-up">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rapbase</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/stagingData.html">Staging data: principles and set-up</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Rapporteket/rapbase/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Staging data: principles and set-up</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Rapporteket/rapbase/blob/main/vignettes/stagingData.Rmd" class="external-link"><code>vignettes/stagingData.Rmd</code></a></small>
      <div class="d-none name"><code>stagingData.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Registry applications at Rapporteket normally obtains data by opening
connections to a database containing raw registry data. Before figures,
tables and reports can be made, data usually have to be filtered,
combined and analyzed. Depending on the amount of data and the
complexity of the analysis this process can be time-consuming. Quite
often, such pre-processing can be generalized and does not have to be
run each and every time a user interacts with a registry application.
Staging data allow for such pre-processed data to be stored for quick
and easy retrieval and therefore reduce the time the registry
applications need to spend on processing data.</p>
<p>This document aim to describe how staging of data works and how to
enable it at Rapporteket.</p>
</div>
<div class="section level2">
<h2 id="backend">Backend<a class="anchor" aria-label="anchor" href="#backend"></a>
</h2>
<p>Staging data may be stored as binary files or as blobs in a database.
In any case, creating and retrieving staging data follow the same scheme
regardless of how it is stored. Selecting a backend is configurable and
will apply globally, <em>i.e.</em> for all registry applications at
Rapporteket.</p>
<div class="section level3">
<h3 id="file">File<a class="anchor" aria-label="anchor" href="#file"></a>
</h3>
<p>To store staging data as binary files make sure to set the property
<strong>target</strong> to the value <strong>file</strong> in
<em>$R_RAP_CONFIG_PATH/rapbaseConfig.yml</em>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">...</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">  # Staging data</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">  staging:</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">    target: file</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">    key: staging</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">...</span></span></code></pre></div>
<p>When staging data is stored as files the property
<strong>key</strong> is not in use and may take any value. For a given
registry <em>MyRegistry</em> staging of the data set <em>MyData</em>
will then be stored with the file path
<em>R_RAP_CONFIG_PATH/stagingData/MyRegistry/MyData</em>.</p>
</div>
<div class="section level3">
<h3 id="database">Database<a class="anchor" aria-label="anchor" href="#database"></a>
</h3>
<p>To store staging data as blobs in a database make sure to set the
property <strong>target</strong> to the value <strong>db</strong> in
<em>$R_RAP_CONFIG_PATH/rapbaseConfig.yml</em>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">...</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">  # Staging data</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">  staging:</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">    target: db</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">    key: stagingDb</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">...</span></span></code></pre></div>
<p>When staging data is stored in a database <strong>key</strong> must
match the corresponding entry in
<em>$R_RAP_CONFIG_PATH/dbConfig.yml</em> that provides the database
connection credentials:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co">...</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">stagingDb:</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">  host: database_server_hostname_or_ip</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">  name: database_name</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">  user: some_username</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">  pass: password_for_some_username</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">  disp: optional_information</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">...</span></span></code></pre></div>
<p>The database server must exist and accept connections as defined in
the above configuration. If the database itself does not exist when an
registry application request staging of data, it will be created.</p>
</div>
</div>
<div class="section level2">
<h2 id="encryption">Encryption<a class="anchor" aria-label="anchor" href="#encryption"></a>
</h2>
<p>Prior to storage the R data structure to become staging data is
serialized to binary, encrypted and compressed. When reading data
already staged this process is reversed. Encryption is based on the
AES256 algorithm and the key applied is generated from the password of
the database credentials as defined in
<em>$R_RAP_CONFIG_PATH/dbConfig.yml</em> for the corresponding registry.
Hence, there will be a registry specific encryption for staged data
meaning that from a common place of storage, staged data will not be
accessible across registries. Protection as provided by the encryption
solely rest on the accessibility of
<em>$R_RAP_CONFIG_PATH/dbConfig.yml</em> that holds the information
needed to decrypt staging data.</p>
</div>
<div class="section level2">
<h2 id="caveats">Caveats<a class="anchor" aria-label="anchor" href="#caveats"></a>
</h2>
<p>If the key used for encryption is lost staging data will no longer be
accessible. If the key cannot be restored all staging data encrypted
with this key will also be forever lost. Hence, if the purpose is to
remove staging data, destroying the key will be a very potent method to
ensure proper deletion, but please note that making staged data
inaccessible may lead to errors in registry applications that uses
staged data. For any number of reasons database credentials for
registries at Rapporteket may also at some point be altered having the
unintentional effect of making staged data inaccessible.</p>
</div>
<div class="section level2">
<h2 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h2>
<p>For developers of registry applications at Rapporteket that wants to
implement staging data, please refer to the staging data function
documentation: <code>help("rapbase::stagingData")</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Are Edvardsen, Kevin Otto Thon, Arnfinn Hykkerud Steindal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
