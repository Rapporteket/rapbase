<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Log user events in shiny applications at Rapporteket — logger • rapbase</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Log user events in shiny applications at Rapporteket — logger" />
<meta property="og:description" content="To be used for logging at application level (i.e. when a shiny
session is started) or at report level (i.e. each time a report is
run). Logging of single report events should be made from reactive
environments within the shiny server function or from within the (report)
functions used by the same reactive environments." />
<meta property="og:image" content="/logo.svg" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-145582048-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-145582048-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rapbase</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.17.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/Rapporteket/rapbase/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Log user events in shiny applications at Rapporteket</h1>
    <small class="dont-index">Source: <a href='http://github.com/Rapporteket/rapbase/blob/master/R/log.R'><code>R/log.R</code></a></small>
    <div class="hidden name"><code>logger.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>To be used for logging at application level (<em>i.e.</em> when a shiny
session is started) or at report level (<em>i.e.</em> each time a report is
run). Logging of single report events should be made from reactive
environments within the shiny server function or from within the (report)
functions used by the same reactive environments.</p>
    </div>

    <pre class="usage"><span class='fu'>appLogger</span><span class='op'>(</span><span class='va'>session</span>, msg <span class='op'>=</span> <span class='st'>"No message provided"</span><span class='op'>)</span>

<span class='fu'>repLogger</span><span class='op'>(</span>
  <span class='va'>session</span>,
  msg <span class='op'>=</span> <span class='st'>"No message provided"</span>,
  .topcall <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>sys.call</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,
  .topenv <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'>autLogger</span><span class='op'>(</span>
  <span class='va'>user</span>,
  <span class='va'>name</span>,
  <span class='va'>registryName</span>,
  <span class='va'>reshId</span>,
  <span class='va'>type</span>,
  <span class='va'>pkg</span>,
  <span class='va'>fun</span>,
  <span class='va'>param</span>,
  msg <span class='op'>=</span> <span class='st'>"No message provided"</span>,
  .topenv <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>session</th>
      <td><p>Shiny session object to be used for getting user data.
For testing and development purposes <code>session</code> can be replaced by
<code><a href='https://rdrr.io/r/base/list.html'>list()</a></code> in which case various config options might be used to provide
something sensible.</p></td>
    </tr>
    <tr>
      <th>msg</th>
      <td><p>String providing a user defined message to be added to the log
record. Default value is 'No message provided'.</p></td>
    </tr>
    <tr>
      <th>.topcall</th>
      <td><p>Parent call (if any) calling this function. Used to provide
the function call with arguments. Default value is <code><a href='https://rdrr.io/r/base/sys.parent.html'>sys.call(-1)</a></code>.</p></td>
    </tr>
    <tr>
      <th>.topenv</th>
      <td><p>Name of the parent environment calling this function. Used to
provide package name (<em>i.e.</em> register) this function was called from.
Default value is <code><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame()</a></code>.</p></td>
    </tr>
    <tr>
      <th>user</th>
      <td><p>String providing owner of an automated report. Its value should
correspond to the actual user name as provided in a shiny session at
Rapporteket. Only used for subscription reports that are run outside a shiny
session.</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>String providing full name of the report owner. Only used for
automated reports that are run outside a shiny session.</p></td>
    </tr>
    <tr>
      <th>registryName</th>
      <td><p>String providing registry name. Only used for automated
reports that are run outside a shiny session.</p></td>
    </tr>
    <tr>
      <th>reshId</th>
      <td><p>String providing the organization id of the (subscription)
report author. Only used for automated reports that are run outside a shiny
session.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>Character string defining the type of report. Only used for
automated reports that are run outside a shiny session in which case its
value will replace that of <code>.topcall</code>.</p></td>
    </tr>
    <tr>
      <th>pkg</th>
      <td><p>Character string naming the package of the function that is to be
logged. Only used for automated reports that are run outside a shiny
session.</p></td>
    </tr>
    <tr>
      <th>fun</th>
      <td><p>Character string naming the function that should be logged. Only
used for automated reports that are run outside a shiny session.</p></td>
    </tr>
    <tr>
      <th>param</th>
      <td><p>List of named function parameter. Only used for automated
reports that are run outside a shiny session.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns nothing but calls a logging appender</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The below fields will be appended to the log, in the following order:</p><ol>
<li><p><code>time</code>: date-time as event is logged as
    <code><a href='https://rdrr.io/r/base/format.html'>format(time, "%Y-%m-%d %H:%M:%S")</a></code></p></li>
<li><p><code>user</code>: username as found in the shiny session object or as
  provided by function argument (<code>subLogger()</code>)</p></li>
<li><p><code>name</code>: full name of user as found in the shiny session object</p></li>
<li><p><code>group</code>: users group membership as provided by the shiny
    session object. Normally, this will correspond to the registry the user
    belongs to</p></li>
<li><p><code>role</code>: users role as provided by the shiny session object. Its
    value will depend on whatever is delivered by the autorization provider,
    but for OpenQReg registires 'LU' (local user) and 'SC' (system
    coordinator) are typical values</p></li>
<li><p><code>resh_id</code>: the organization id of the current user as provided
    by the shiny session object, OR, when source of logging is auto reports,
    the organization ID of the data source used to make the report</p></li>
<li><p><code>environment</code>: environment from where the logger function was
    called (only provided by <code>repLogger()</code>)</p></li>
<li><p><code>call</code>: function (with arguments) from where the logger was
    called (only provided by <code>repLogger()</code>)</p></li>
<li><p>message: an optional message defined as argument to the function</p></li>
</ol>

<p>The <code>autLogger()</code> function is a special case to be used for automated
reports. Since such reports are run outside a reactive (shiny) context
shiny session data are not available to the logger. Hence, logging data
must be provided as arguments directly. As of rapbase version 1.12.0 logging
of automated reports are already taken care of. Hence, this function should
not be applied per registry application.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Pseudo code of how <code>appLogger()</code> may be implemented:</p><pre>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://shiny.rstudio.com/'>shiny</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>raplog</span><span class='op'>)</span>

<span class='va'>server</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>input</span>, <span class='va'>output</span>, <span class='va'>session</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>raplog</span><span class='fu'>::</span><span class='fu'>appLogger</span><span class='op'>(</span><span class='va'>session</span>, msg <span class='op'>=</span> <span class='st'>"Smerteregisteret: starting shiny app"</span><span class='op'>)</span>
  <span class='va'>...</span>
<span class='op'>}</span>
</pre><p>Pseudo code on how <code>repLogger()</code> can be implemented as part of a
function in a reactive (shiny) context. First, this is an example of the
shiny server function with the (reactive) function <code><a href='https://rdrr.io/pkg/shiny/man/renderPlot.html'>renderPlot()</a></code>
calling a function that provides a histogram:</p><pre>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://shiny.rstudio.com/'>shiny</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>raplog</span><span class='op'>)</span>

<span class='va'>server</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>input</span>, <span class='va'>output</span>, <span class='va'>session</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>...</span>
  <span class='va'>output</span><span class='op'>$</span><span class='va'>hist</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/shiny/man/renderPlot.html'>renderPlot</a></span><span class='op'>(</span><span class='op'>{</span>
    <span class='fu'>makeHist</span><span class='op'>(</span><span class='va'>data</span>, var <span class='op'>=</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>var</span>, bins <span class='op'>=</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>bins</span>, session <span class='op'>=</span> <span class='va'>session</span><span class='op'>)</span>
  <span class='op'>}</span><span class='op'>)</span>
  <span class='va'>...</span>
<span class='op'>}</span>
</pre><p>Then, logging is called within the function <code>makeHist()</code>:</p><pre>
<span class='va'>makeHist</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>var</span>, <span class='va'>bins</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>

  <span class='kw'>if</span> <span class='op'>(</span><span class='st'>"session"</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='fu'>raplog</span><span class='fu'>::</span><span class='fu'>repLogger</span><span class='op'>(</span>session <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"session"</span><span class='op'>]</span><span class='op'>]</span>,
                      msg <span class='op'>=</span> <span class='st'>"Providing histogram"</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='va'>...</span>
<span class='op'>}</span>
</pre>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'># Depend on the environment variable R_RAP_CONFIG_PATH being set</span>
<span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'>appLogger</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; Error in appendLog(event, name, target = "file", format = "csv") : 
#&gt;   There is nowhere to append the logging event. The environment variable R_RAP_CONFIG_PATH should be defined!</div><div class='input'><span class='co'># }</span>

<span class='co'># \donttest{</span>
<span class='co'># Depend on the environment variable R_RAP_CONFIG_PATH being set</span>
<span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'>repLogger</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; <span class='message'>System has no defined instance. Configuration as provided by</span>
#&gt; <span class='message'>            'rapbaseConfig.yml' will be used as source for user data.</span></div><div class='output co'>#&gt; Error in appendLog(event, name, target = "file", format = "csv") : 
#&gt;   There is nowhere to append the logging event. The environment variable R_RAP_CONFIG_PATH should be defined!</div><div class='input'><span class='co'># }</span>

<span class='co'># \donttest{</span>
<span class='co'># Depend on the environment variable R_RAP_CONFIG_PATH being set</span>
<span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'>autLogger</span><span class='op'>(</span>user <span class='op'>=</span> <span class='st'>"ttester"</span>, registryName <span class='op'>=</span> <span class='st'>"rapbase"</span>, reshId <span class='op'>=</span> <span class='st'>"999999"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Error in autLogger(user = "ttester", registryName = "rapbase", reshId = "999999") : 
#&gt;   argument "name" is missing, with no default</div><div class='input'><span class='co'># }</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Are Edvardsen, Kevin Otto Thon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


