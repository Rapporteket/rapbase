<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Low level functions for handling registry staging data at Rapporteket. As
such, these functions does not provide staging data management per se.
Proper management, e.g. staging data updates and fallback logic
must therefore be established within each registry that take staging data
into use."><title>Staging data functions — stagingData • rapbase</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Staging data functions — stagingData"><meta property="og:description" content="Low level functions for handling registry staging data at Rapporteket. As
such, these functions does not provide staging data management per se.
Proper management, e.g. staging data updates and fallback logic
must therefore be established within each registry that take staging data
into use."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rapbase</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.24.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/stagingData.html">Staging data: principles and set-up</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Rapporteket/rapbase/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Staging data functions</h1>
      <small class="dont-index">Source: <a href="https://github.com/Rapporteket/rapbase/blob/HEAD/R/stagingData.R" class="external-link"><code>R/stagingData.R</code></a></small>
      <div class="d-none name"><code>stagingData.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Low level functions for handling registry staging data at Rapporteket. As
such, these functions does not provide staging data management <em>per se</em>.
Proper management, <em>e.g.</em> staging data updates and fallback logic
must therefore be established within each registry that take staging data
into use.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">listStagingData</span><span class="op">(</span><span class="va">registryName</span>, dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"R_RAP_CONFIG_PATH"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mtimeStagingData</span><span class="op">(</span><span class="va">registryName</span>, dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"R_RAP_CONFIG_PATH"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">saveStagingData</span><span class="op">(</span></span>
<span>  <span class="va">registryName</span>,</span>
<span>  <span class="va">dataName</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"R_RAP_CONFIG_PATH"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">loadStagingData</span><span class="op">(</span><span class="va">registryName</span>, <span class="va">dataName</span>, dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"R_RAP_CONFIG_PATH"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">deleteStagingData</span><span class="op">(</span></span>
<span>  <span class="va">registryName</span>,</span>
<span>  <span class="va">dataName</span>,</span>
<span>  dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"R_RAP_CONFIG_PATH"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cleanStagingData</span><span class="op">(</span><span class="va">eolAge</span>, dryRun <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>registryName</dt>
<dd><p>Character string providing the registry name.</p></dd>


<dt>dir</dt>
<dd><p>Character string providing the path to where the staging data
directory resides in case of storage as files. Default value is
<code>Sys.getenv("R_RAP_CONFIG_PATH")</code>.</p></dd>


<dt>dataName</dt>
<dd><p>Character string providing the data set name.</p></dd>


<dt>data</dt>
<dd><p>A data object such as a data.frame to be stored as
<code>dataName</code>.</p></dd>


<dt>eolAge</dt>
<dd><p>Numeric providing the staging data end-of-life age in seconds.
Based on the current time and the time of storage staging files
older than <code>eolAge</code> will be identified as subject for removal.</p></dd>


<dt>dryRun</dt>
<dd><p>Logical defining if function is to be run in dry (none
destructive) mode.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<ul><li><p><code>listStagingData()</code> returns a character vector of staging data
    sets for the given registry (<code>registryName</code>).</p></li>
<li><p><code>mtimeStagingData()</code> returns a staging data set named POSIXct
    vector of modification times for the given registry
    (<code>registryName</code>).</p></li>
<li><p><code>saveStagingData()</code> when successful returns the data object
    (<code>data</code>), invisibly. If saving fails a warning is issued and the
    function returns FALSE.</p></li>
<li><p><code>loadStagingData()</code> returns the data object corresponding to
    the name given upon saving (<code>dataName</code>). If the requested data set
    for loading does not exist the function returns FALSE.</p></li>
<li><p><code>deleteStagingData()</code> returns TRUE if the data set was deleted
    and FALSE if not.</p></li>
<li><p><code>cleanStagingData()</code> returns a list of data sets (to be)
    removed.</p></li>
<li><p><code>rapbase:::pathStagingData()</code> is an internal helper function and
    returns a character string with the path to the staging directory of
    <code>registryName</code>. If its parent directory (<code>dir</code>) does not exists
    an error is returned.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Staging data can be stored as files or as binary large objects in a database
and method of choice is defined by the <code>rapbase</code> configuration.
Regardless of storage method a per registry symmetric encryption of storage
content is enforced. Keys used for encryption are generated from existing
database credentials. Therefore, please note that removing or changing
such credentials will render any historic staging data inaccessible.</p>
<p><code>cleanStagingData()</code> globally removes all staging data with store date
prior to the end-of-life age provided. This is a vastly destructive function
that should be used with great care.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Prep test data</span></span></span>
<span class="r-in"><span><span class="va">registryName</span> <span class="op">&lt;-</span> <span class="st">"rapbase"</span></span></span>
<span class="r-in"><span><span class="va">dataName</span> <span class="op">&lt;-</span> <span class="st">"testData"</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span></span>
<span class="r-in"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Save data for staging</span></span></span>
<span class="r-in"><span><span class="fu">saveStagingData</span><span class="op">(</span><span class="va">registryName</span>, <span class="va">dataName</span>, <span class="va">data</span>, <span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## List data currently in staging</span></span></span>
<span class="r-in"><span><span class="fu">listStagingData</span><span class="op">(</span><span class="va">registryName</span>, <span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "testData"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Retrieve data set from staging and compare to outset</span></span></span>
<span class="r-in"><span><span class="va">stagedData</span> <span class="op">&lt;-</span> <span class="fu">loadStagingData</span><span class="op">(</span><span class="va">registryName</span>, <span class="va">dataName</span>, <span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">stagedData</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get modification time for staging file(s)</span></span></span>
<span class="r-in"><span><span class="fu">mtimeStagingData</span><span class="op">(</span><span class="va">registryName</span>, <span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  testData </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> "2024-06-05 11:14:56 UTC" </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Are Edvardsen, Kevin Otto Thon, Arnfinn Hykkerud Steindal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

