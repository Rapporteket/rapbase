<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Staging data functions — stagingData • rapbase</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Staging data functions — stagingData"><meta name="description" content="Low level functions for handling registry staging data at Rapporteket. As
such, these functions does not provide staging data management per se.
Proper management, e.g. staging data updates and fallback logic
must therefore be established within each registry that take staging data
into use."><meta property="og:description" content="Low level functions for handling registry staging data at Rapporteket. As
such, these functions does not provide staging data management per se.
Proper management, e.g. staging data updates and fallback logic
must therefore be established within each registry that take staging data
into use."><meta property="og:image" content="/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rapbase</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Rapporteket/rapbase/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Staging data functions</h1>
      <small class="dont-index">Source: <a href="https://github.com/Rapporteket/rapbase/blob/v2.4.0/R/stagingData.R" class="external-link"><code>R/stagingData.R</code></a></small>
      <div class="d-none name"><code>stagingData.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Low level functions for handling registry staging data at Rapporteket. As
such, these functions does not provide staging data management <em>per se</em>.
Proper management, <em>e.g.</em> staging data updates and fallback logic
must therefore be established within each registry that take staging data
into use.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">listStagingData</span><span class="op">(</span><span class="va">registryName</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mtimeStagingData</span><span class="op">(</span><span class="va">registryName</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">saveStagingData</span><span class="op">(</span><span class="va">registryName</span>, <span class="va">dataName</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">loadStagingData</span><span class="op">(</span><span class="va">registryName</span>, <span class="va">dataName</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">deleteStagingData</span><span class="op">(</span><span class="va">registryName</span>, <span class="va">dataName</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cleanStagingData</span><span class="op">(</span><span class="va">eolAge</span>, dryRun <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-registryname">registryName<a class="anchor" aria-label="anchor" href="#arg-registryname"></a></dt>
<dd><p>Character string providing the registry name.</p></dd>


<dt id="arg-dataname">dataName<a class="anchor" aria-label="anchor" href="#arg-dataname"></a></dt>
<dd><p>Character string providing the data set name.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data object such as a data.frame to be stored as
<code>dataName</code>.</p></dd>


<dt id="arg-eolage">eolAge<a class="anchor" aria-label="anchor" href="#arg-eolage"></a></dt>
<dd><p>Numeric providing the staging data end-of-life age in seconds.
Based on the current time and the time of storage staging files
older than <code>eolAge</code> will be identified as subject for removal.</p></dd>


<dt id="arg-dryrun">dryRun<a class="anchor" aria-label="anchor" href="#arg-dryrun"></a></dt>
<dd><p>Logical defining if function is to be run in dry (none
destructive) mode.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>

<ul><li><p><code>listStagingData()</code> returns a character vector of staging data
    sets for the given registry (<code>registryName</code>).</p></li>
<li><p><code>mtimeStagingData()</code> returns a staging data set named POSIXct
    vector of modification times for the given registry
    (<code>registryName</code>).</p></li>
<li><p><code>saveStagingData()</code> when successful returns the data object
    (<code>data</code>), invisibly. If saving fails a warning is issued and the
    function returns FALSE.</p></li>
<li><p><code>loadStagingData()</code> returns the data object corresponding to
    the name given upon saving (<code>dataName</code>). If the requested data set
    for loading does not exist the function returns FALSE.</p></li>
<li><p><code>deleteStagingData()</code> returns TRUE if the data set was deleted
    and FALSE if not.</p></li>
<li><p><code>cleanStagingData()</code> returns a list of data sets (to be)
    removed.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Staging data is stored as binary large objects in a database.
A per registry symmetric encryption of storage
content is enforced. Keys used for encryption are generated from existing
database credentials. Therefore, please note that removing or changing
such credentials will render any historic staging data inaccessible.</p>
<p><code>cleanStagingData()</code> globally removes all staging data with store date
prior to the end-of-life age provided. This is a vastly destructive function
that should be used with great care.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">## Prep test data</span></span></span>
<span class="r-in"><span><span class="va">registryName</span> <span class="op">&lt;-</span> <span class="st">"rapbase"</span></span></span>
<span class="r-in"><span><span class="va">dataName</span> <span class="op">&lt;-</span> <span class="st">"testData"</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Save data for staging</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">saveStagingData</span><span class="op">(</span><span class="va">registryName</span>, <span class="va">dataName</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in getDbConfig(key) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Could not connect to database because the enviroment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        variables MYSQL_HOST, MYSQL_USER and/or MYSQL_PASSWORD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        are not defined. Please check configuration.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## List data currently in staging</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">listStagingData</span><span class="op">(</span><span class="va">registryName</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in getDbConfig(key) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Could not connect to database because the enviroment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        variables MYSQL_HOST, MYSQL_USER and/or MYSQL_PASSWORD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        are not defined. Please check configuration.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Retrieve data set from staging and compare to outset</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="va">stagedData</span> <span class="op">&lt;-</span> <span class="fu">loadStagingData</span><span class="op">(</span><span class="va">registryName</span>, <span class="va">dataName</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in getDbConfig(key) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Could not connect to database because the enviroment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        variables MYSQL_HOST, MYSQL_USER and/or MYSQL_PASSWORD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        are not defined. Please check configuration.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">stagedData</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : object 'stagedData' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get modification time for staging file(s)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">mtimeStagingData</span><span class="op">(</span><span class="va">registryName</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in getDbConfig(key) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Could not connect to database because the enviroment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        variables MYSQL_HOST, MYSQL_USER and/or MYSQL_PASSWORD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        are not defined. Please check configuration.</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Are Edvardsen, Kevin Otto Thon, Arnfinn Hykkerud Steindal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

