<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Log user events in shiny applications at Rapporteket — logger • rapbase</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Log user events in shiny applications at Rapporteket — logger"><meta name="description" content="To be used for logging at application level (i.e. when a shiny
session is started) or at report level (i.e. each time a report is
run). Logging of single report events should be made from reactive
environments within the shiny server function or from within the (report)
functions used by the same reactive environments."><meta property="og:description" content="To be used for logging at application level (i.e. when a shiny
session is started) or at report level (i.e. each time a report is
run). Logging of single report events should be made from reactive
environments within the shiny server function or from within the (report)
functions used by the same reactive environments."><meta property="og:image" content="/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rapbase</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.24.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/stagingData.html">Staging data: principles and set-up</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Rapporteket/rapbase/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Log user events in shiny applications at Rapporteket</h1>
      <small class="dont-index">Source: <a href="https://github.com/Rapporteket/rapbase/blob/master/R/log.R" class="external-link"><code>R/log.R</code></a></small>
      <div class="d-none name"><code>logger.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>To be used for logging at application level (<em>i.e.</em> when a shiny
session is started) or at report level (<em>i.e.</em> each time a report is
run). Logging of single report events should be made from reactive
environments within the shiny server function or from within the (report)
functions used by the same reactive environments.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">appLogger</span><span class="op">(</span></span>
<span>  <span class="va">session</span>,</span>
<span>  msg <span class="op">=</span> <span class="st">"No message provided"</span>,</span>
<span>  .topcall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">sys.call</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  .topenv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">repLogger</span><span class="op">(</span></span>
<span>  <span class="va">session</span>,</span>
<span>  msg <span class="op">=</span> <span class="st">"No message provided"</span>,</span>
<span>  .topcall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">sys.call</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  .topenv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">autLogger</span><span class="op">(</span></span>
<span>  <span class="va">user</span>,</span>
<span>  <span class="va">name</span>,</span>
<span>  <span class="va">registryName</span>,</span>
<span>  <span class="va">reshId</span>,</span>
<span>  <span class="va">type</span>,</span>
<span>  <span class="va">pkg</span>,</span>
<span>  <span class="va">fun</span>,</span>
<span>  <span class="va">param</span>,</span>
<span>  msg <span class="op">=</span> <span class="st">"No message provided"</span>,</span>
<span>  .topenv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-session">session<a class="anchor" aria-label="anchor" href="#arg-session"></a></dt>
<dd><p>Shiny session object to be used for getting user data.
For testing and development purposes <code>session</code> can be replaced by
<code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> in which case various config options might be used to provide
something sensible.</p></dd>


<dt id="arg-msg">msg<a class="anchor" aria-label="anchor" href="#arg-msg"></a></dt>
<dd><p>String providing a user defined message to be added to the log
record. Default value is 'No message provided'.</p></dd>


<dt id="arg--topcall">.topcall<a class="anchor" aria-label="anchor" href="#arg--topcall"></a></dt>
<dd><p>Parent call (if any) calling this function. Used to provide
the function call with arguments. Default value is <code>sys.call(-1)</code>.</p></dd>


<dt id="arg--topenv">.topenv<a class="anchor" aria-label="anchor" href="#arg--topenv"></a></dt>
<dd><p>Name of the parent environment calling this function. Used to
provide package name (<em>i.e.</em> register) this function was called from.
Default value is <code><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame()</a></code>.</p></dd>


<dt id="arg-user">user<a class="anchor" aria-label="anchor" href="#arg-user"></a></dt>
<dd><p>String providing owner of an automated report. Its value should
correspond to the actual user name as provided in a shiny session at
Rapporteket. Only used for subscription reports that are run outside a shiny
session.</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>String providing full name of the report owner. Only used for
automated reports that are run outside a shiny session.</p></dd>


<dt id="arg-registryname">registryName<a class="anchor" aria-label="anchor" href="#arg-registryname"></a></dt>
<dd><p>String providing registry name. Only used for automated
reports that are run outside a shiny session.</p></dd>


<dt id="arg-reshid">reshId<a class="anchor" aria-label="anchor" href="#arg-reshid"></a></dt>
<dd><p>String providing the organization id of the (subscription)
report author. Only used for automated reports that are run outside a shiny
session.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Character string defining the type of report. Only used for
automated reports that are run outside a shiny session in which case its
value will replace that of <code>.topcall</code>.</p></dd>


<dt id="arg-pkg">pkg<a class="anchor" aria-label="anchor" href="#arg-pkg"></a></dt>
<dd><p>Character string naming the package of the function that is to be
logged. Only used for automated reports that are run outside a shiny
session.</p></dd>


<dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>Character string naming the function that should be logged. Only
used for automated reports that are run outside a shiny session.</p></dd>


<dt id="arg-param">param<a class="anchor" aria-label="anchor" href="#arg-param"></a></dt>
<dd><p>List of named function parameter. Only used for automated
reports that are run outside a shiny session.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns nothing but calls a logging appender</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The below fields will be appended to the log, in the following order:</p><ol><li><p><code>time</code>: date-time as event is logged as
    <code>format(time, "%Y-%m-%d %H:%M:%S")</code></p></li>
<li><p><code>user</code>: username as found in the shiny session object or as
  provided by function argument</p></li>
<li><p><code>name</code>: full name of user as found in the shiny session object</p></li>
<li><p><code>group</code>: users group membership as provided by the shiny
    session object. Normally, this will correspond to the registry the user
    belongs to</p></li>
<li><p><code>role</code>: users role as provided by the shiny session object. Its
    value will depend on whatever is delivered by the authorization provider,
    but for OpenQReg registries 'LU' (local user) and 'SC' (system
    coordinator) are typical values</p></li>
<li><p><code>resh_id</code>: the organization id of the current user as provided
    by the shiny session object, OR, when source of logging is auto reports,
    the organization ID of the data source used to make the report</p></li>
<li><p><code>environment</code>: environment from where the logger function was
    called (only provided by <code>repLogger()</code>)</p></li>
<li><p><code>call</code>: function (with arguments) from where the logger was
    called (only provided by <code>repLogger()</code>)</p></li>
<li><p>message: an optional message defined as argument to the function</p></li>
</ol><p>The <code>autLogger()</code> function is a special case to be used for automated
reports. Since such reports are run outside a reactive (shiny) context
shiny session data are not available to the logger. Hence, logging data
must be provided as arguments directly. As of rapbase version 1.12.0 logging
of automated reports are already taken care of. Hence, this function should
not be applied per registry application.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Pseudo code of how <code>appLogger()</code> may be implemented:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">raplog</span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">raplog</span><span class="fu">::</span><span class="fu">appLogger</span><span class="op">(</span><span class="va">session</span>, msg <span class="op">=</span> <span class="st">"Smerteregisteret: starting shiny app"</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div><p>Pseudo code on how <code>repLogger()</code> can be implemented as part of a
function in a reactive (shiny) context. First, this is an example of the
shiny server function with the (reactive) function <code>renderPlot()</code>
calling a function that provides a histogram:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">raplog</span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">makeHist</span><span class="op">(</span><span class="va">data</span>, var <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">var</span>, bins <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">bins</span>, session <span class="op">=</span> <span class="va">session</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div><p>Then, logging is called within the function <code>makeHist()</code>:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">makeHist</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">var</span>, <span class="va">bins</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"session"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">raplog</span><span class="fu">::</span><span class="fu">repLogger</span><span class="op">(</span>session <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">[[</span><span class="st">"session"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                      msg <span class="op">=</span> <span class="st">"Providing histogram"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Depend on the environment variable R_RAP_CONFIG_PATH being set</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">appLogger</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System has no defined instance. Configuration as provided by</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             'rapbaseConfig.yml' will be used as source for user data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System has no defined instance. Configuration as provided by</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             'rapbaseConfig.yml' will be used as source for user data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System has no defined instance. Configuration as provided by</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             'rapbaseConfig.yml' will be used as source for user data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System has no defined instance. Configuration as provided by</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             'rapbaseConfig.yml' will be used as source for user data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System has no defined instance. Configuration as provided by</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             'rapbaseConfig.yml' will be used as source for user data.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in appendLog(event, name) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   There is nowhere to append the logfiles. The environment variable R_RAP_CONFIG_PATH should be defined!</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Depend on the environment variable R_RAP_CONFIG_PATH being set</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">repLogger</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System has no defined instance. Configuration as provided by</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             'rapbaseConfig.yml' will be used as source for user data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System has no defined instance. Configuration as provided by</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             'rapbaseConfig.yml' will be used as source for user data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System has no defined instance. Configuration as provided by</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             'rapbaseConfig.yml' will be used as source for user data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System has no defined instance. Configuration as provided by</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             'rapbaseConfig.yml' will be used as source for user data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System has no defined instance. Configuration as provided by</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             'rapbaseConfig.yml' will be used as source for user data.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in appendLog(event, name) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   There is nowhere to append the logfiles. The environment variable R_RAP_CONFIG_PATH should be defined!</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Depend on the environment variable R_RAP_CONFIG_PATH being set</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">autLogger</span><span class="op">(</span>user <span class="op">=</span> <span class="st">"ttester"</span>, registryName <span class="op">=</span> <span class="st">"rapbase"</span>, reshId <span class="op">=</span> <span class="st">"999999"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in autLogger(user = "ttester", registryName = "rapbase", reshId = "999999") : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   argument "name" is missing, with no default</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Are Edvardsen, Kevin Otto Thon, Arnfinn Hykkerud Steindal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

